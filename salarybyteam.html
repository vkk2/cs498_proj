<!DOCTYPE html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>2017-2018 NBA Team Salary</title>
    
    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            position: relative;
            width: 960px;
        }
        .axis text {
            font: 10px sans-serif;
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        .bar {
            //fill: steelblue;
            fill-opacity: .9;
        }
        .x.axis path {
            display: none;
        }
        label {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        rect:hover {
            fill: orange;
        }
        rect {
            -moz-transition: all 0.3s;
            -o-transition: all 0.3s;
            -webkit-transition: all 0.3s;
            transition: all 0.3s;
        }

        #tooltip {
            position: absolute;
            width: 200px;
            height: auto;
            padding: 10px;
            background-color: rgb(220, 228, 223);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }

        #tooltip.hidden {
            display: none;
        }

        #tooltip p {
            margin: 0;
            font-family: sans-serif;
            font-size: 16px;
            line-height: 20px;
        }

    </style>
</head>

<body style="font-family:'Times New Roman', Times, serif;">
        <p>
            The below chart can display sorted Country wise Players list.<br><br>
            <i>Click on the check box to sort the chat. Click again to unsort.</i>
        </p>
    <label><input type="checkbox"> Sort by Salary per team</label>

    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script>
        
			var margin = {top: 20, right: 20, bottom: 100, left: 100},
				width = 2060 - margin.left - margin.right,
				height = 500 - margin.top - margin.bottom;
        //var format = d3.format(".0");
		//var format = d3.format("s");
        //var x = d3.scaleOrdinal()
            //.rangeRoundBands([0, width-90], .1, 1);
			//.range([0,width-90]);
			//.round(true);
		var x=d3.scaleBand().rangeRound([0, width]).padding(0.1);
			//.range([0,width-90])
			//.round(true);
        var y = d3.scaleLinear().rangeRound([height, 0]);
         //   .range([height, 0]);
        //var xAxis = d3.svg.axis()
          //  .scale(x)
            //.orient("bottom");
        //var yAxis = d3.svg.axis()
          //  .scale(y)
            //.orient("left")
            //.tickFormat(format);
		var color = d3.scaleOrdinal().range(["#ffd700", "#0ba0e3", "#ff9bdc", "#4b0082","#0000ff",
												"#008000", "#ffa500", "#ff0000", "#969dff","#ff1a55",
												"#b55ff6", "#d11e5d", "#b297ba", "#78b0df","#3d3d3d",
												"#7000f8", "#bbc2c8", "#6e8692", "#aaaaaa","#f6cd37",
												"#83a0a6", "#c1442e", "#514d5b", "#e18a7a","#ffdab9",
												"#ff9a9a", "#afeeee", "#ffd700", "#81f67d","#d7bdee"]).domain(["ATL", "BOS", "BRK", "CHI", "CHO", "CLE", "DAL", "DEN", "DET", "GSW", "HOU", "IND", 
																												"LAC", "LAL", "MEM", "MIA", "MIL", "MIN", "NOP", "NYK", "OKC", "ORL", "PHI", "PHO", 
																												"POR", "SAC", "SAS", "TOR", "UTA", "WAS"]);
		var render=data => {
			

		            // don't want dots overlapping axis, so add in buffer to data domain
            //   xScale = d3.scale.linear().range([0, width])
            x.domain(data.map(function(d) { return d.COUNTRY; }));
            y.domain([50000000, d3.max(data, function(d) { return d.VALUE; })]);
            svg.append("g")
                .attr("class", "x axis")
                //.attr("transform", "translate(0," + height + ")")
				.attr("transform", `translate(${0}, ${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")  
                        .style("text-anchor", "end")
                        .attr("dx", "-.5em")
                        .attr("dy", "-.9em")
                        .attr("transform", function(d) {
                            return "rotate(-90)" 
                        });
            svg.append("g")
                .attr("class", "y axis")
                .call(d3.axisLeft(y))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Player Count");

            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", function(d) { return x(d.COUNTRY); })
                //.attr("width", x.rangeBand())
				.attr("width", x.bandwidth())
                .attr("y", function(d) { return y(d.VALUE); })
				.attr("fill",function(d,i){return color(i)})
                .attr("height", function(d) { return height - y(d.VALUE); })
				
                .on("mouseover", function(d) {

                    //Get this bar's x/y values, then augment for the tooltip
                    var xPosition = parseFloat(d3.select(this).attr("x")) ;
                    var yPosition = parseFloat(d3.select(this).attr("y")) / 2 ;

                    //Update the tooltip position and value
                    d3.select("#tooltip")
                        .style("left", xPosition + "px")
                        .style("top", yPosition + "px")						
                        .select("#value")
                        .text(d);

                    //Show the tooltip
                    d3.select("#tooltip").classed("hidden", false);
                })
                .on("mouseout", function() {
                
                    //Hide the tooltip
                    d3.select("#tooltip").classed("hidden", true);
                    
                
                })
                .append("title")
                .text(function(d) {
                    return "Salary:- "+d.VALUE;
                    });
                d3.select("input").on("change", change);
                // var sortTimeout = setTimeout(function() {
                // d3.select("input").property("checked", true).each(change);
                //}, 2000);
            function change() {
                //clearTimeout(sortTimeout);
                var x0 = x.domain(data.sort(this.checked
                    ? function(a, b) { return b.VALUE - a.VALUE; }
                    : function(a, b) { return d3.ascending(a.COUNTRY, b.COUNTRY); })
                    .map(function(d) { return d.COUNTRY; }))
                    .copy();
                svg.selectAll(".bar")
                    .sort(function(a, b) { return x0(a.COUNTRY) - x0(b.COUNTRY); });
                var transition = svg.transition().duration(550),
                    delay = function(d, i) { return i * 50; };
                transition.selectAll(".bar")
                    .delay(delay)
                    .attr("x", function(d) { return x0(d.COUNTRY); });
                transition.select(".x.axis")
                    //.call(xAxis)
					.call(d3.axisBottom(x))
                    .selectAll("g")
                    .delay(delay)
                    .selectAll("text")  
                    .style("text-anchor", "end")
                    .attr("dx", "-.5em")
                    .attr("dy", "-.9em")
                    .attr("transform", function(d) {
                        return "rotate(-90)" 
                    });
            }
		};
		
        var svg = d3.select("body")
			.append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
			.append("g")
            //.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
			.attr("transform", `translate( ${margin.left}, ${margin.top})`);
        d3.csv("https://raw.githubusercontent.com/vkk2/cs498_proj/master/teamsalarywin.csv").then(data => {
            data.forEach(d=> {
                d.VALUE = +d.Salary;
                d.COUNTRY =  d["Tm"];
            });
			//data.sort(function(a,b){ return b.VALUE-a.VALUE});
			render(data);

        });
    </script>
</body>